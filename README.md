# Mega poll

Супер платформа для создания опросиков

## Docker

### Сборка

```text
docker build --tag mega_poll .
```

### Запуск

```text
docker run -p 8080:8080 mega_poll
```

## API

### /active/

GET запрос. Возвращает список id действительных опросов.

```json
{
    "active": [
        1,
        2,
        5
    ]
}
```

### /poll/{poll_id}/

GET запрос. Возвращает информацию о запросе **poll_id** со следующими параметрами: id, название опроса, дата и время начала, дата и время окончания, описание опроса и список id вопросов этого опроса.

```json
{
    "id": 1,
    "name": "Опрос о котиках",
    "start": "2021-01-01T00:00:00Z",
    "end": "2021-01-31T23:59:59Z",
    "description": "Это просто опрос о котиках",
    "questions": [
        1,
        2,
        7
    ]
}
```

### /question/{question_id}/

GET запрос. Возвращает информацию о вопросе **question_id** со следующими параметрами: id, текст вопроса, тип ответа (0 - текстовый ответ, 1 - вопрос с одним вариантом ответа, 2 - вопрос с одним и более вариантами ответа), id опроса, в котором участвует этот вопрос, список id вариантов ответа на данный вопрос (для вопросов 1 и 2 типа).

```json
{
    "id": 1,
    "text": "Как звали Вашего первого котика?",
    "answer_type": 0,
    "poll": 1
}

{
    "id": 2,
    "text": "Котики какого цвета Вам больше нравятся?",
    "answer_type": 1,
    "poll": 1,
    "options": [
        1,
        2,
        3
    ]
}
```

### /option/{option_type}/

GET запрос. Возвращает информацию о варианте ответа **option_id** со следующими параметрами: id, текст варианта, id вопроса, к которому относится этот вариант ответа.

```json
{
    "id": 1,
    "text": "Черные",
    "question": 2
}
```

### /answer/

POST запрос. Принимает на вход json следующего формата: целочисленный id пользователя, который проходит опрос, целочисленный id опроса, список ответов. Список ответов представляет из себя список объектов следюущего формата: id вопроса, на который дается ответ, для вопросов типа 0 в поле **answer** пишется текстовый ответ на вопрос, для вопросов типа 1 в него пишется целочисленный id выбранной опции, для вопросов типа 2 в данное поле записывается список целочисленных id выбранных опций.

```json
{
    "id": 10,
    "poll": 1,
    "answers": [
        {
            "question": 1,
            "answer": "Васька"
        },
        {
            "question": 2,
            "answer": 1
        },
        {
            "question": 7,
            "answer": [
                5,
                8,
                10
            ]
        }
    ]
}
```

В ответ придет схожая структура. В списке **answers** будет находиться информация об ошибках при обработке ответов. Если в этом списке нет информации об ответе, значит он был корректно обработан.

```json
{
    "id": 10,
    "poll": 1,
    "answers": [
        {
            "question": 7,
            "error": "Option 10 does not exist"
        }
    ]
}
```

### /answers/{user_id}/

GET запрос. Возвращает список пройденных пользователем **user_id** опросов следующего формата: id
опроса, список ответов, где id вопроса и, в завимости от типа вопроса, либо текстовый ответ, либо id варианта ответа, либо список id вариантов ответов.

```json
{
    "user_id": 10,
    "done": [
        {
            "poll": 1,
            "answers": [
                {
                    "question_id": 1,
                    "answer": "Васька"
                },
                ...
            ]
        },
        ...
    ]
}
```
